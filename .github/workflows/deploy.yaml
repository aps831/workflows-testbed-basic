---
name: Deploy
on:
  push:
  issue_comment:
    types:
      - created
permissions:
  contents: read
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - id: validate-branch
        uses: aps831/gh-actions/deploy-branch-validate@feat/validate-branch
        with:
          branch: ${{ github.ref_name }}
          branch-check-against: master
          max-no-commits: 2
          path: "/dev"

      - shell: bash
        run: |
          echo "**Deploy Branch Validate**" >> $GITHUB_STEP_SUMMARY

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "***Comparing branch '${{ github.ref_name }}' against 'master'***" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          echo "| Key          | Value                                             |" >> $GITHUB_STEP_SUMMARY
          echo "| ------------ | ------------------------------------------------- |" >> $GITHUB_STEP_SUMMARY
          echo "| not-behind   | ${{ steps.validate-branch.outputs.not-behind }}   |" >> $GITHUB_STEP_SUMMARY
          echo "| not-ahead-by | ${{ steps.validate-branch.outputs.not-ahead-by }} |" >> $GITHUB_STEP_SUMMARY
          echo "| changes      | ${{ steps.validate-branch.outputs.changes }}      |" >> $GITHUB_STEP_SUMMARY

      - shell: bash
        run: |
          if [[ "${{ steps.validate-branch.outputs.not-behind }}" == "false" ]]; then
            exit 1
          fi
          if [[ "${{ steps.validate-branch.outputs.not-ahead-by }}" == "false" ]]; then
            exit 1
          fi
          if [[ "${{ steps.validate-branch.outputs.changes }}" == "false" ]]; then
            exit 1
          fi
          exit 0
